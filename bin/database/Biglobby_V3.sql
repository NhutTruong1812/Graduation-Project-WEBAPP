USE MASTER
GO

IF EXISTS (SELECT NAME FROM SYS.databases WHERE NAME ='Biglobby')
    DROP DATABASE Biglobby
GO

USE MASTER 
CREATE DATABASE Biglobby
GO
USE Biglobby

GO
--TABLE ROLE
CREATE TABLE tbl_role(
	id BIGINT IDENTITY(1,1) PRIMARY KEY,
	[role] NVARCHAR(100) NOT NULL,
	[description] NVARCHAR(500) NULL
);

GO

--TABLE ACTION
CREATE TABLE tbl_action(
	id BIGINT IDENTITY(1,1) PRIMARY KEY,
	tbl_action NVARCHAR(100) NOT NULL,
	[description] NVARCHAR(500) NULL
);

GO
--TABLE STATUS
CREATE TABLE tbl_Status(
	id BIGINT IDENTITY(1,1) PRIMARY KEY,
	[status] NVARCHAR(100) NOT NULL,
	[description] NVARCHAR(500) NULL
);

GO
--TABLE PROBLEM
CREATE TABLE tbl_problem(
	id BIGINT IDENTITY(1,1) PRIMARY KEY,
	problem NVARCHAR(100) NOT NULL,
	[description] NVARCHAR(500) NULL
);

GO
--TABLE USER
CREATE TABLE tbl_user(
	id BIGINT IDENTITY(1,1) PRIMARY KEY,
	username NVARCHAR(50) UNIQUE NOT NULL,
	[password] NVARCHAR(50) NOT NULL,
	fullname NVARCHAR(50) NOT NULL,
	email NVARCHAR(50) NOT NULL,
	phonenum NVARCHAR(10) NOT NULL,
	avatar NVARCHAR(100) NULL,
	blocked BIT DEFAULT 1 NOT NULL,
	last_login SMALLDATETIME NOT NULL
);
GO
--TABLE REGISTERACTIVE
CREATE TABLE tbl_register_active(
	id BIGINT IDENTITY(1,1) PRIMARY KEY,
	id_user BIGINT UNIQUE NOT NULL,
	register_date SMALLDATETIME NOT NULL,
	actived BIT DEFAULT 0 NOT NULL,
	FOREIGN KEY (id_user) REFERENCES tbl_user(id) ON DELETE NO ACTION ON UPDATE NO ACTION
);
GO
--TABLE AUTHORITY
CREATE TABLE tbl_authority(
	id BIGINT IDENTITY(1,1) PRIMARY KEY,
	id_user BIGINT NOT NULL,
	id_role BIGINT NOT NULL,
	authorize_date SMALLDATETIME NOT NULL,
	FOREIGN KEY (id_user) REFERENCES tbl_user(id) ON DELETE NO ACTION ON UPDATE NO ACTION,
	FOREIGN KEY (id_role) REFERENCES tbl_role(id) ON DELETE NO ACTION ON UPDATE NO ACTION
);
GO
--TABLE MYBCOIN
CREATE TABLE tbl_my_bcoin(
	id BIGINT IDENTITY(1,1) PRIMARY KEY,
	id_user BIGINT UNIQUE NOT NULL,
	coinnum INT NOT NULL,
	FOREIGN KEY (id_user) REFERENCES tbl_user(id) ON DELETE NO ACTION ON UPDATE NO ACTION
);
GO
--TABLE BCOINHISTORY
CREATE TABLE tbl_bcoin_history(
	id BIGINT IDENTITY(1,1) PRIMARY KEY,
	id_user BIGINT NOT NULL,
	quantity INT NOT NULL,
	id_action BIGINT NOT NULL,
	note NVARCHAR(500) NOT NULL,
	coin_date SMALLDATETIME NOT NULL,
	act_by BIGINT NOT NULL,
	FOREIGN KEY (id_user) REFERENCES tbl_user(id) ON DELETE NO ACTION ON UPDATE NO ACTION,
	FOREIGN KEY (id_action) REFERENCES tbl_action(id) ON DELETE NO ACTION ON UPDATE NO ACTION,
	FOREIGN KEY (act_by) REFERENCES tbl_user(id) ON DELETE NO ACTION ON UPDATE NO ACTION
);
GO
--TABLE BSERVICE
CREATE TABLE tbl_bservice(
	id BIGINT IDENTITY(1,1) PRIMARY KEY,
	bservice NVARCHAR(100) NOT NULL,
	banner NVARCHAR(100) NOT NULL,
	[description] NVARCHAR(500) NOT NULL
);

GO
--TABLE MYBSERVICE
CREATE TABLE tbl_mybservice(
	id BIGINT IDENTITY(1,1) PRIMARY KEY,
	id_user BIGINT NOT NULL,
	id_bservice BIGINT NOT NULL,
	FOREIGN KEY (id_user) REFERENCES tbl_user(id) ON DELETE NO ACTION ON UPDATE NO ACTION,
	FOREIGN KEY (id_bservice) REFERENCES tbl_bservice(id) ON DELETE NO ACTION ON UPDATE NO ACTION
);
GO

--TABLE BSERVICEHISTORY
CREATE TABLE tbl_bservice_history(
	id BIGINT IDENTITY(1,1) PRIMARY KEY,
	id_user BIGINT NOT NULL,
	id_bservice BIGINT NOT NULL,
	act_date SMALLDATETIME NOT NULL,
	use_days INT NOT NULL,
	act_by BIGINT NOT NULL,
	id_action BIGINT NOT NULL,
	FOREIGN KEY (id_user) REFERENCES tbl_user(id) ON DELETE NO ACTION ON UPDATE NO ACTION,
	FOREIGN KEY (id_bservice) REFERENCES tbl_bservice(id) ON DELETE NO ACTION ON UPDATE NO ACTION,
	FOREIGN KEY (act_by) REFERENCES tbl_user(id) ON DELETE NO ACTION ON UPDATE NO ACTION,
	FOREIGN KEY (id_action) REFERENCES tbl_action(id) ON DELETE NO ACTION ON UPDATE NO ACTION
);
GO
--TABLE BSERVICEPRICE
CREATE TABLE tbl_bservice_price(
	id BIGINT IDENTITY(1,1) PRIMARY KEY,
	price FLOAT NOT NULL,
	price_date SMALLDATETIME NOT NULL,
	price_by BIGINT NOT NULL,
	id_bservice BIGINT NOT NULL,
	note NVARCHAR(500) NOT NULL,
	FOREIGN KEY (price_by) REFERENCES tbl_user(id) ON DELETE NO ACTION ON UPDATE NO ACTION,
	FOREIGN KEY (id_bservice) REFERENCES tbl_bservice(id) ON DELETE NO ACTION ON UPDATE NO ACTION
);
GO
--TALBE MYSHOP
CREATE TABLE tbl_myshop(
	id BIGINT IDENTITY(1,1) PRIMARY KEY,
	id_user BIGINT UNIQUE NOT NULL,
	intro NVARCHAR(100) NOT NULL,
	[location] NVARCHAR(500) NOT NULL,
	FOREIGN KEY (id_user) REFERENCES tbl_user(id) ON DELETE NO ACTION ON UPDATE NO ACTION
);
GO
--TABLE ADDRESS
CREATE TABLE tbl_address(
	id BIGINT IDENTITY(1,1) PRIMARY KEY,
	id_user BIGINT NOT NULL,
	fullname NVARCHAR(50) NOT NULL,
	phonenum NVARCHAR(10) NOT NULL,
	[address] NVARCHAR(500) NOT NULL,
	FOREIGN KEY (id_user) REFERENCES tbl_user(id) ON DELETE NO ACTION ON UPDATE NO ACTION
);
GO
--TABLE FOLLOWSHOP
CREATE TABLE tbl_follow_shop(
	id BIGINT IDENTITY(1,1) PRIMARY KEY,
	id_userFollow BIGINT NOT NULL,
	id_shop BIGINT NOT NULL,
	followDate SMALLDATETIME NOT NULL,
	FOREIGN KEY (id_userFollow) REFERENCES tbl_user(id) ON DELETE NO ACTION ON UPDATE NO ACTION,
	FOREIGN KEY (id_shop) REFERENCES tbl_myshop(id) ON DELETE NO ACTION ON UPDATE NO ACTION
);

GO
--TABLE DISPLAYFEE
CREATE TABLE tbl_displayfee(
	id BIGINT IDENTITY(1,1) PRIMARY KEY,
	price_from FLOAT NOT NULL,
	price_to FLOAT NOT NULL,
	fixed_fee FLOAT NOT NULL,
	percent_fee FLOAT NOT NULL,
	[description] NVARCHAR(500) NOT NULL,
);
GO
--TABLE DISPLAYFEEHISTORY
CREATE TABLE tbl_displayfee_history(
	id BIGINT IDENTITY(1,1) PRIMARY KEY,
	price_from FLOAT NOT NULL,
	price_to FLOAT NOT NULL,
	fixed_fee FLOAT NOT NULL,
	percent_fee FLOAT NOT NULL,
	act_date SMALLDATETIME NOT NULL,
	act_by BIGINT NOT NULL,
	id_displayfee BIGINT NOT NULL,
	id_action BIGINT NOT NULL,
	FOREIGN KEY (act_by) REFERENCES tbl_user(id) ON DELETE NO ACTION ON UPDATE NO ACTION,
	FOREIGN KEY (id_displayfee) REFERENCES tbl_displayfee(id) ON DELETE NO ACTION ON UPDATE NO ACTION,
	FOREIGN KEY (id_action ) REFERENCES tbl_action(id) ON DELETE NO ACTION ON UPDATE NO ACTION
);

GO
--TABLE NEWS
CREATE TABLE tbl_news(
	id BIGINT IDENTITY(1,1) PRIMARY KEY,
	id_sent BIGINT NOT NULL,
	id_got BIGINT NOT NULL,
	[content] NVARCHAR(500) NOT NULL,
	news_date SMALLDATETIME NOT NULL,
	[hidden] BIT DEFAULT 0 NOT NULL,
	FOREIGN KEY (id_sent) REFERENCES tbl_user(id) ON DELETE NO ACTION ON UPDATE NO ACTION,
	FOREIGN KEY (id_got) REFERENCES tbl_user(id) ON DELETE NO ACTION ON UPDATE NO ACTION
);
GO
--TABLE CATEGORY
CREATE TABLE tbl_category(
	id BIGINT IDENTITY(1,1) PRIMARY KEY,
	category NVARCHAR(100) NOT NULL,
	[description] NVARCHAR(500) NOT NULL,
	blocked BIT DEFAULT 0 NOT NULL,
	add_by BIGINT NOT NULL,
	id_status BIGINT NOT NULL,
	add_date SMALLDATETIME NOT NULL,
	FOREIGN KEY (add_by) REFERENCES tbl_user(id) ON DELETE NO ACTION ON UPDATE NO ACTION,
	FOREIGN KEY (id_status) REFERENCES tbl_status(id) ON DELETE NO ACTION ON UPDATE NO ACTION
);
GO
--TABLE CARD 
CREATE TABLE tbl_card(
	id BIGINT IDENTITY(1,1) PRIMARY KEY,
	is_product BIT NOT NULL,
	id_status BIGINT NOT NULL,
	[hidden] BIT DEFAULT 0 NOT NULL,
	FOREIGN KEY (id_status) REFERENCES tbl_status(id) ON DELETE NO ACTION ON UPDATE NO ACTION
);
GO
--TABLE POST
CREATE TABLE tbl_post(
	id BIGINT IDENTITY(1,1) PRIMARY KEY,
	id_card BIGINT UNIQUE NOT NULL,
	title NVARCHAR(100) NOT NULL,
	[content] NVARCHAR(500) NOT NULL,
	banner NVARCHAR(100) NOT NULL,
	FOREIGN KEY (id_card) REFERENCES tbl_card(id) ON DELETE NO ACTION ON UPDATE NO ACTION
);
GO
--TABLE PRODUCT
CREATE TABLE tbl_product(
	id BIGINT IDENTITY(1,1) PRIMARY KEY,
	id_card BIGINT UNIQUE NOT NULL,
	product NVARCHAR(100) NOT NULL,
	banner NVARCHAR(100) NOT NULL,
	available INT NOT NULL,
	[description] NVARCHAR(500) NULL,
	price FLOAT NOT NULL,
	price_percent FLOAT NOT NULL,
	id_category BIGINT NOT NULL,
	FOREIGN KEY (id_card) REFERENCES tbl_card(id) ON DELETE NO ACTION ON UPDATE NO ACTION,
	FOREIGN KEY (id_category) REFERENCES tbl_category(id) ON DELETE NO ACTION ON UPDATE NO ACTION
);
GO
--TABLE PRODUCTHISTORY 
CREATE TABLE tbl_product_history(
	id BIGINT IDENTITY(1,1) PRIMARY KEY,
	id_product BIGINT NOT NULL,
	price FLOAT NOT NULL,
	quantity INT NOT NULL,
	act_date SMALLDATETIME NOT NULL,
	act_by BIGINT NOT NULL,
	id_action BIGINT NOT NULL,
	FOREIGN KEY (id_product) REFERENCES tbl_product(id) ON DELETE NO ACTION ON UPDATE NO ACTION,
	FOREIGN KEY (act_by) REFERENCES tbl_user(id) ON DELETE NO ACTION ON UPDATE NO ACTION,
	FOREIGN KEY (id_action) REFERENCES tbl_action(id) ON DELETE NO ACTION ON UPDATE NO ACTION
);

GO
--TABLE CARDSUBBANNER
CREATE TABLE tbl_card_subbanner(
	id BIGINT IDENTITY(1,1) PRIMARY KEY,
	id_card BIGINT NOT NULL,
	subbanner NVARCHAR(100) NOT NULL,
	FOREIGN KEY (id_card) REFERENCES tbl_card(id) ON DELETE NO ACTION ON UPDATE NO ACTION
);
GO
--TABLE BSERVICESUBBANNER
CREATE TABLE tbl_bservice_subbanner(
	id BIGINT IDENTITY(1,1) PRIMARY KEY,
	id_bservice BIGINT NOT NULL,
	subbanner NVARCHAR(100) NOT NULL,
	FOREIGN KEY (id_bservice) REFERENCES tbl_bservice(id) ON DELETE NO ACTION ON UPDATE NO ACTION
);
GO
--TABLE ORDER
CREATE TABLE tbl_order(
	 id BIGINT IDENTITY(1,1) PRIMARY KEY,
	 id_buyer BIGINT NOT NULL,
	 fullname NVARCHAR(100) NOT NULL,
	 phonenum NVARCHAR(10) NOT NULL,
	 [address] NVARCHAR(500) NOT NULL,
	 add_date SMALLDATETIME NOT NULL,
	 note_buyer NVARCHAR(500) NULL,
	 note_saler NVARCHAR(500) NULL,
	 id_status BIGINT NOT NULL,
	 id_saler BIGINT NOT NULL,
	 FOREIGN KEY (id_buyer) REFERENCES tbl_user(id) ON DELETE NO ACTION ON UPDATE NO ACTION,
	 FOREIGN KEY (id_status) REFERENCES tbl_status(id) ON DELETE NO ACTION ON UPDATE NO ACTION,
	 FOREIGN KEY (id_saler) REFERENCES tbl_user(id) ON DELETE NO ACTION ON UPDATE NO ACTION
);
 GO
 --TABLE ORDERDETAIL
 CREATE TABLE tbl_orderdetail(
	id BIGINT IDENTITY(1,1) PRIMARY KEY,
	id_order BIGINT NOT NULL,
	id_product BIGINT NOT NULL,
	quantity INT NOT NULL,
	price FLOAT NOT NULL,
	FOREIGN KEY (id_order) REFERENCES tbl_order(id) ON DELETE NO ACTION ON UPDATE NO ACTION,
	FOREIGN KEY (id_product) REFERENCES tbl_product(id) ON DELETE NO ACTION ON UPDATE NO ACTION
 );
 GO
 --TABLE CART
 CREATE TABLE tbl_cart(
	id BIGINT IDENTITY(1,1) PRIMARY KEY,
	id_user BIGINT NOT NULL,
	id_product BIGINT NOT NULL,
	quantity INT NOT NULL,
	cart_date SMALLDATETIME NOT NULL, 
	FOREIGN KEY (id_user) REFERENCES tbl_user(id) ON DELETE NO ACTION ON UPDATE NO ACTION,
	FOREIGN KEY (id_product) REFERENCES tbl_product(id) ON DELETE NO ACTION ON UPDATE NO ACTION
 );
 GO
 --TABLE LOVECARD
 CREATE TABLE tbl_lovecard(
	id BIGINT IDENTITY(1,1) PRIMARY KEY,
	id_user BIGINT NOT NULL,
	id_card BIGINT NOT NULL,
	love_date SMALLDATETIME NOT NULL,
	FOREIGN KEY (id_user) REFERENCES tbl_user(id) ON DELETE NO ACTION ON UPDATE NO ACTION,
	FOREIGN KEY (id_card) REFERENCES tbl_card(id) ON DELETE NO ACTION ON UPDATE NO ACTION
 );
 GO
 --TABLE COMMENTCARD
CREATE TABLE tbl_commentcard(
	id BIGINT IDENTITY(1,1) PRIMARY KEY,
	id_user BIGINT NOT NULL,
	id_card BIGINT NOT NULL,
	comment_date SMALLDATETIME NOT NULL,
	[content] NVARCHAR(500) NOT NULL,
	FOREIGN KEY (id_user) REFERENCES tbl_user(id) ON DELETE NO ACTION ON UPDATE NO ACTION,
	FOREIGN KEY (id_card) REFERENCES tbl_card(id) ON DELETE NO ACTION ON UPDATE NO ACTION,
);
GO
--TABLE REPCOMMENT
CREATE TABLE tbl_repcomment(
	id BIGINT IDENTITY(1,1) PRIMARY KEY,
	id_comment BIGINT NOT NULL,
	id_user BIGINT NOT NULL,
	rep_comment_date SMALLDATETIME NOT NULL,
	[content] NVARCHAR(500) NOT NULL,
	FOREIGN KEY (id_comment) REFERENCES tbl_commentcard(id) ON DELETE NO ACTION ON UPDATE NO ACTION,
	FOREIGN KEY (id_user) REFERENCES tbl_user(id) ON DELETE NO ACTION ON UPDATE NO ACTION
);
GO
--TABLE SHARECARD
CREATE TABLE tbl_sharecard(
	id BIGINT IDENTITY(1,1) PRIMARY KEY,
	id_user BIGINT NOT NULL,
	id_card BIGINT NOT NULL,
	share_date SMALLDATETIME NOT NULL,
	FOREIGN KEY (id_user) REFERENCES tbl_user(id) ON DELETE NO ACTION ON UPDATE NO ACTION,
	FOREIGN KEY (id_card) REFERENCES tbl_card(id) ON DELETE NO ACTION ON UPDATE NO ACTION
);
GO
--TABLE HIDECARD
CREATE TABLE tbl_hidecard(
	id BIGINT IDENTITY(1,1) PRIMARY KEY,
	id_user BIGINT NOT NULL,
	id_card BIGINT NOT NULL,
	hide_date SMALLDATETIME NOT NULL,
	FOREIGN KEY (id_user) REFERENCES tbl_user(id) ON DELETE NO ACTION ON UPDATE NO ACTION,
	FOREIGN KEY (id_card) REFERENCES tbl_card(id) ON DELETE NO ACTION ON UPDATE NO ACTION
);
GO
--TABLE REPORTCARD
CREATE TABLE tbl_reportcard(
	id BIGINT IDENTITY(1,1) PRIMARY KEY,
	id_user BIGINT NOT NULL,
	id_card BIGINT NOT NULL,
	report_date SMALLDATETIME NOT NULL,
	id_problem BIGINT NOT NULL,
	note NVARCHAR(500) NULL,
	FOREIGN KEY (id_user) REFERENCES tbl_user(id) ON DELETE NO ACTION ON UPDATE NO ACTION,
	FOREIGN KEY (id_card) REFERENCES tbl_card(id) ON DELETE NO ACTION ON UPDATE NO ACTION,
	FOREIGN KEY (id_problem) REFERENCES tbl_problem(id) ON DELETE NO ACTION ON UPDATE NO ACTION
);
GO
--TABLE FAILHISTORY
CREATE TABLE tbl_fail_history(
	id BIGINT IDENTITY(1,1) PRIMARY KEY,
	id_card BIGINT NOT NULL,
	fail_reason NVARCHAR(500) NOT NULL,
	fail_date SMALLDATETIME NOT NULL,
	fail_by BIGINT NOT NULL,
	FOREIGN KEY (id_card) REFERENCES tbl_card(id) ON DELETE NO ACTION ON UPDATE NO ACTION,
	FOREIGN KEY (fail_by) REFERENCES tbl_user(id) ON DELETE NO ACTION ON UPDATE NO ACTION
);

--DONE





